{% extends 'global/skeleton.html' %}

{% block pagename %}Riepilogo sondaggio{% endblock pagename %}

{% block content %}
<div class="container text-center mt-5 mb-5">
    <h1>{{ poll.name }}</h1>
    <h2 class="text-info">Dettagli sul sondaggio</h2>
</div>

<div class="container border">

    <div class="container mt-5 mb-5">
        <p class="text-info fs-4 mb-0">Testo della domanda: </p>
        <p class="fs-3 mb-0">{{ poll.question }} </p>
    </div>

            <div class="container mt-5 mb-5">
                <p class="text-info fs-4 mb-0">Opzioni della domanda: </p>
                {% for option in poll.options %}
                    <div class="fw md-2">
                        <h4>{{ option.value }}</h4>
                    </div>
                {% endfor %}
            </div>

            <div class="container mt-5 mb-5">
                <p class="text-info fs-4 mb-0">Tipo di sondaggio: </p>
                <h4>{{ poll.get_type_verbose_name }}</h4>
            </div>

            {% if poll.is_open %}
                {% if not poll.is_closed %}
                    <div class="container mt-5 mb-5">
                        <p class="text-info fs-4 mb-0">Stato del sondaggio: </p>
                        <h4>APERTO</h4>
                    </div>
                    {% else %}
                    <div class="container mt-5 mb-5">
                        <p class="text-info fs-4 mb-0">Stato del sondaggio: </p>
                        <h4>CHIUSO</h4>
                    </div>
                    {% endif %}
                {% else %}
                    <div class="container mt-5 mb-5">
                        <p class="text-info fs-4 mb-0">Stato del sondaggio: </p>
                        <h4>NON APERTO </h4>
                    </div>
            {% endif %}

                {% if poll.is_open and not poll.is_closed %}
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end m-2">
                        <a href="{% url 'apps.votes_results:single_option_vote' poll_id=poll.id %}" 
                            class="btn btn-primary me-md-2 mt-2" 
                            role="button">Vota</a>
                {% elif poll.is_closed %}
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end m-2">
                        <a href="{% url 'apps.votes_results:single_option_results' poll_id=poll.id %}" 
                            class="btn btn-secondary me-md-2 mt-2"  
                            role="button">Vedi risultati</a>
                    </div>
                </div>
                {% endif %}

            {% comment %} Poll open date if present {% endcomment %}
            {% if poll.open_datetime %}
            <div class="container mt-5 mb-5">
                <p class="text-info fs-4 mb-0">Data di apertura del sondaggio: </p>
                <h4>{{ poll.open_datetime }}</h4>
            </div>
            {% endif %}

            {% comment %} Poll close date {% endcomment %}
            {% if poll.close_datetime %}
            <div class="container mt-5 mb-5">
                <p class="text-info fs-4 mb-0">Data di chiusura del sondaggio: </p>
                <h4>{{ poll.close_datetime }}</h4>
            </div>
            {% endif %}

            {# Return button #}
            <div class="container mt-5">
                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                    <a name="" id="" role="button"
                        class="btn btn-primary m-2" 
                        href="{% url 'apps.polls_management:all_polls' %}?page=1&per_page=10" >
                        Ritorna alla lista di tutti i sondaggi
                    </a>
            </div>

            {% comment %} Edit, delete and open poll buttons {% endcomment %}
            {% if not poll.is_open and not poll.is_closed %}
            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                    <a name="" id="" role="button"
                        class="btn btn-warning m-2" 
                        href="{% url 'apps.polls_management:poll_edit' poll_id=poll.id %}" >
                        Modifica sondaggio
                    </a>

                    <form action="{% url 'apps.polls_management:poll_delete' poll_id=poll.id %}" method="POST">
                        {% csrf_token %}
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <button type="submit" class="btn btn-danger m-2">Elimina sondaggio</button>
                        </div>
                    </form>

            {% comment %} Open poll button {% endcomment %}

                <form action="{% url 'apps.polls_management:poll_open' poll_id=poll.id %}" method="POST">
                    {% csrf_token %}
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <button type="submit" class="btn btn-info m-2">Apri sondaggio</button>
                    </div>
                </form>
            </div>
            {% endif %}
        </div>
    </div>

</div>
{% endblock content %}